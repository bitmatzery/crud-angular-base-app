<div class="search-container">
  <mat-form-field appearance="fill" class="search-field">
    <mat-icon matPrefix class="search-icon">search</mat-icon>
    <input
      matInput
      placeholder="Поиск товаров..."
      [formControl]="searchControl"
      class="search-input"
      aria-label="Поиск товаров"
      type="search"
      (focus)="onFocus()"
      (blur)="onBlur()"
    />
    <button
      *ngIf="searchControl.value"
      matSuffix
      mat-icon-button
      aria-label="Очистить поиск"
      (click)="clearSearch()"
      class="clear-button"
    >
      <mat-icon>close</mat-icon>
    </button>
  </mat-form-field>

  <!-- Выпадающие результаты поиска -->
  <div *ngIf="showResults && searchResults.length > 0" class="search-results">
    <div class="search-results-header">
      <span>Найдено товаров: {{ searchResults.length }}</span>
      <button mat-icon-button class="close-results" (click)="hideResults()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div
      *ngFor="let product of searchResults; trackBy: trackByProductId"
      class="search-result-item"
      (click)="selectProduct(product)"
    >
      <div class="product-image">
        <img
          [src]="getProductImage(product)"
          [alt]="product.title"
          (error)="onImageError($event)"
          class="product-img"
        >
      </div>
      <div class="product-info">
        <div class="product-title">{{ product.title }}</div>
        <div class="product-price">{{ product.price | currency:'RUB':'symbol' }}</div>
        <div class="product-category" *ngIf="product.category">
          {{ product.category.name }}
        </div>
      </div>
    </div>
    <div class="search-results-footer">
      <button mat-icon-button class="view-all-btn" (click)="viewAllResults()">
        Показать все результаты
      </button>
    </div>
  </div>

  <!-- Сообщение об отсутствии результатов -->
  <div *ngIf="showResults && searchResults.length === 0 && hasSearched && searchControlValue.length > 2"
       class="search-no-results">
    <div class="no-results-content">
      <mat-icon class="no-results-icon">search_off</mat-icon>
      <span class="no-results-text">По запросу "{{ searchControlValue }}" ничего не найдено</span>
    </div>
  </div>
</div>
