<mat-toolbar class="header-navbar" color="primary">
  <div class="navbar-container container-app">
    <!-- Логотип и название -->
    <div class="logo-section">
      <a routerLink="/home" class="logo-link">
        <logo-ui class="header-logo" [size]="36" variant="inverted"></logo-ui>
        <span class="site-name">AlwaysMarket</span>
      </a>
    </div>

    <!-- Центральное меню -->
    <div class="center-section">
      <nav class="nav-menu">
        <button mat-button routerLink="/home" routerLinkActive="active" class="nav-button">
          <mat-icon>home</mat-icon>
          <span>Главная</span>
        </button>
        <button mat-button routerLink="/products" routerLinkActive="active" class="nav-button">
          <mat-icon>shopping_bag</mat-icon>
          <span>Товары</span>
        </button>

        <!-- Кнопка "Пользователи" видна только админам -->
        <button
          *ngIf="(userRole$ | async) === 'admin'"
          mat-button
          routerLink="/users"
          routerLinkActive="active"
          class="nav-button"
        >
          <mat-icon>people</mat-icon>
          <span>Пользователи</span>
        </button>

        <!-- Кнопка "Dashboard" видна только админам -->
        <button
          *ngIf="(userRole$ | async) === 'admin'"
          mat-button
          routerLink="/dashboard"
          routerLinkActive="active"
          class="nav-button"
        >
          <mat-icon>dashboard</mat-icon> 
          <span>Dashboard</span> 
        </button>
      </nav>
    </div>

    <!-- Правая часть: поиск, тема, авторизация -->
    <div class="right-section">
      <!-- Поиск с отступом сверху -->
      <div class="search-wrapper">
        <header-search-ui (search)="onSearch($event)" class="header-search"></header-search-ui>
      </div>

      <!-- Переключение темы -->
      <theme-toggle-ui class="theme-toggle"></theme-toggle-ui>

      <!-- Авторизация -->
      <div class="auth-section">
        <ng-container *ngIf="isLoggedIn$ | async as isLoggedIn; else showLoginForm">
          <div class="user-info">
            <span class="username-text">Привет, {{ userEmail$ | async }}!</span>
            <button
              class="logout-button"
              mat-icon-button
              type="button"
              aria-label="Logout"
              (click)="onLogout()"
              matTooltip="Выйти"
            >
              <mat-icon>logout</mat-icon>
            </button>
          </div>
        </ng-container>

        <ng-template #showLoginForm>
          <form class="login-form" [formGroup]="form" (ngSubmit)="onSubmit()">
            <div class="form-fields">
              <mat-form-field class="login-form-field" appearance="outline">
                <mat-label>Email</mat-label>
                <input
                  matInput
                  placeholder="Введите email"
                  formControlName="email"
                  type="email"
                  aria-label="Email"
                  class="form-input"
                />
              </mat-form-field>

              <mat-form-field class="login-form-field" appearance="outline">
                <mat-label>Пароль</mat-label>
                <input
                  matInput
                  placeholder="Введите пароль"
                  formControlName="password"
                  type="password"
                  aria-label="Password"
                  class="form-input"
                />
              </mat-form-field>
            </div>

            <button
              class="login-button"
              mat-raised-button
              type="submit"
              aria-label="Login"
              [disabled]="!form.valid"
            >
              <mat-icon>login</mat-icon>
              <span>Войти</span>
            </button>
          </form>
        </ng-template>
      </div>
    </div>
  </div>
</mat-toolbar>

<!-- Логи доступа (можно скрыть или убрать) -->
<div class="access-logs" *ngIf="showLogs">
  <h3>Recent Access Attempts</h3>
  <div class="log-entry" *ngFor="let log of logService.getLogs()">
    <span class="timestamp">{{ log.timestamp | date:'medium' }}</span>
    <span class="user" [class.guest]="log.email === 'Guest'">
      {{ log.email }}
    </span>
    <span class="role">({{ log.userRole }})</span>
    <span class="url">attempted to access: {{ log.targetUrl }}</span>
  </div>
</div>